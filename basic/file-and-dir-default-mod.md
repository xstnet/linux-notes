## Linux 中文件与目录的默认权限

Linux下创建文件和目录分别可以使用命令`touch`和`mkdir`。创建的文件默认作为不可执行文件，因此没有`x(execute)`权限。

而创建的目录则默认是有x执行权限的，因为进入目录需要 `x`权限。



### 关于权限的权重

- `r`: 权重4, 代表具有可读权限
- `w`: 权重2, 代表具有可写权限
- `x`: 权重1, 对于文件, 代表具有可执行权限, 对于目录, 代表具有可进入该目录的权限



### 创建文件和目录时的默认权限

使用命令 `umask` 来查看

```bash
$ umask
0022
```

上面的命令有4位, 第一位为特殊权限, 这里不说, 只说后面的3位, 也就是 `022`, 分别对应 `user`, `group`, `others`这三个权限位



而每一位的数字又代表了什么意思呢?  其时是代表了对应位置减掉的权限

用全部的权重值`r+w+x=7` , 用7来减去每一位对应的权限, 如第一位`0`, 则代表不去除权限, `user`拥有全部的权限即`rwx`

> 这里有一点要注意一下, `Linux`默认把文件的`w`权限去除了, 所以即时对应的位上的数字是0, 最后也只能拥有`rw`的权限,  不会拥有`x`的权限,
>
> 但是对于文件夹来说, `x`的权限还是在的
>
> 所以对于创建文件的时候 , 应该使用 `r+w=6`, 用`6`这个总权重来减

如第二位是数字`2`,  代表对应的用户组去除了`w`的权限,  如果新建一个目录, 则只能有`rx`的权限, 

如果新建一个文件, 则只能有`r`的权限



这里可能会有个疑问, 我们现在的数字是`2`, 正好对应的是`2`, 那如果是 `3`呢?

其实很好算啦, 只要看一下哪些权限相加能等于这个值就行, 如`3`就代表去除`w 和 x`的权限

如果是 `6` 就代表去除了`r+w`的权限



----------

上面使用`umask`命令, 输出了一串数字, 看着不直观, 可以加上一个 `-S`作为参数, 这样看起来更直观, 下面来演示一下

```bash
$ umask -S
u=rwx,g=rx,o=rx
```

可以看到, 这样看起来更清晰, `user`, `group`, `other`默认的权限一目了然

> 上面需要注意下,  对于文件来说,  虽然显示上有x的权限, 但是`Linux`已经去除了, 所以最终还是没有x的权限的



### 修改默认权限

修改默认权限很简单, 直接 `umask 3个权限位 ` 就可以了

比如我想新创建的文件对用户组有可写权限,  从前面我们知道, 默认是`022`对用户组来说, 去除了`w`的权限, 现在我想要把可写权限留给用户组, 不去除`w`的权限

那么很简单, 只要设置为 `002`即可

```bash
umask 002
touch test.txt
ll test.txt
-rw-rw-r-- 1 root root 0 11月 22 22:12 test.txt
```

可以看到,  对于用户组来说, 已经是拥有了`rw`的权限了



### root用户与非root用户的默认权限

在默认的情况下, `root`用户的用户组被拿掉了更多的权限, 默认是 `022`

而一般用户的默认权限是`002`

默认关于 `umask`的配置也可以参考 `/etc/bashrc`这个文件的内容, 在里面搜 `umask`就能看到, 我这里也放出来一部分

目前Linux保留的GID是200

```shell
    # By default, we want umask to get set. This sets it for non-login shell.
    # Current threshold for system reserved uid/gids is 200
    # You could check uidgid reservation validity in
    # /usr/share/doc/setup-*/uidgid file
    if [ $UID -gt 199 ] && [ "`/usr/bin/id -gn`" = "`/usr/bin/id -un`" ]; then
       umask 002
    else
       umask 022
    fi
```

